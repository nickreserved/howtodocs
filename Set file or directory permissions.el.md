# Οδηγός: Ορισμός δικαιωμάτων αρχείων και φακέλων


## `chown`
```Shell
chown -R user αντικείμενο
chown -R user:group αντικείμενο
chgrp -R group αντικείμενο
```
Η παράμετρος `-R` εφαρμόζει την εντολή σε όλη την ιεραρχία του αντικειμένου.


## `chmod`
|Συντόμευση|Ποιος           |
|----------|----------------|
|u         |user - χρήστης  |
|g         |group - ομάδα   |
|o         |others - λοιποί |
|a         |all - όλοι (ugo)|

|Συντόμευση|Τι      |
|----------|--------|
|+         |προσθήκη|
|-         |αφαίρεση|
|=         |ορισμός |

|Συντόμευση|Εξουσιοδότηση     |
|----------|------------------|
|r         |read - ανάγνωση   |
|w         |write - εγγραφή   |
|x         |execute - εκτέλεση|
|s         |special - ειδικό  |
|t         |sticky - κολλώδες |


### Φάκελοι
- **Ανάγνωση:** Επιτρέπεται η ανάγνωση των περιεχόμενων ονομάτων αρχείων και φακέλων από τον αναφερόμενο φάκελο.
- **Εγγραφή:** Επιτρέπεται η δημιουργία αρχείων και φακέλων στον αναφερόμενο φάκελο καθώς και η διαγραφή τους.
- **Εκτέλεση:** Επιτρέπεται η είσοδος ή η διέλευση από τον αναφερόμενο φάκελο.
- **Ειδικό (χρήστης):** Αγνοείται.
- **Ειδικό (ομάδα):** Ασχέτως σε ποιά ομάδα ανήκει ο χρήστης που δημιούργησε το αρχείο, τα αρχεία και οι φάκελοι που δημιουργούνται στον αναφερόμενο φάκελο, θα ανήκουν στην ομάδα στην οποία ανήκει ο αναφερόμενος φάκελος. Αυτό δίνει τη δυνατότητα για συνεργασία μεταξύ μελών της ίδιας ομάδας.
- **Κολλώδες:** Τα αρχεία του αναφερόμενου φακέλου επιτρέπεται να διαγραφούν μόνο από τον root και τον χρήστη στον οποίο ανήκουν.


### Αρχεία
- **Ανάγνωση:** Επιτρέπεται η ανάγνωση των περιεχόμενων του αρχείου.
- **Εγγραφή:** Επιτρέπεται η τροποποίηση του αρχείου.
- **Εκτέλεση:** Επιτρέπεται η εκτέλεση του αρχείου.
- **Ειδικό:** Ασχέτως ποιος χρήστης θα εκτελέσει το αρχείο, το αρχείο θα εκτελεστεί σαν να το εκτέλεσε ο χρήστης και/ή η ομάδα στην οποία ανήκει.
- **Κολλώδες:** Αγνοείται.


### Ορισμός με αρίθμηση
Αριθμός|Συντόμευση      |Θέση   |
|------|----------------|-------|
|4     |r               |1, 2, 3|
|2     |w               |1, 2, 3|
|1     |x               |1, 2, 3|
|4     |s (user - SUID) |0      |
|2     |s (group - GUID)|0      |
|1     |t               |0      |


#### Παραδείγματα
```Shell
chmod 750 directory
```
Οι εξουσιοδοτήσεις για το `directory`, είναι ανάγνωση (4), εγγραφή (2) και εκτέλεση (1) για το χρήστη, ανάγνωση (5) και εκτέλεση (1) για την ομάδα και καμία εξουσιοδότηση για τους υπόλοιπους.

```Shell
chmod 2750 directory
```
Παρόμοια με το προηγούμενο παράδειγμα και επιπλέον, αν ο φάκελος `directory` ανήκει στον χρήστη:ομάδα `joe:joe` και δημιουργήσει ένα αρχείο ο χρήστης:ομάδα `debian-transmission:debian-transmission`, τότε το αρχείο θα ανήκει στο χρήστη `debian-transmission` και στην ομάδα `joe`.

```Shell
chmod 6750 file
```
Οι εξουσιοδοτήσεις για το `file`, είναι ανάγνωση (4), εγγραφή (2) και εκτέλεση (1) για το χρήστη, ανάγνωση (5) και εκτέλεση (1) για την ομάδα και καμία εξουσιοδότηση για τους υπόλοιπους.
Αν το αρχείο `file` ανήκει στον χρήστη:ομάδα `joe:joe` και το εκτελέσει ο χρήστης:ομάδα `jack:jack`, τότε το αρχείο θα εκτελεστεί από τον χρήστη `joe` (4) και από την ομάδα `joe` (2).


### Παραδείγματα:
```Shell
chmod g+sx directory
```
Ο φάκελος `directory` είναι προσπελάσιμος από τα μέλη της ομάδας στην οποία ανήκει.
Οποιοσδήποτε χρήστης δημιουργήσει ένα αρχείο ή φάκελο μέσα στο φάκελο `directory`, το δημιουργηθέν αρχείο ή φάκελος θα ανήκει στην ίδια ομάδα με το φάκελο `directory` και όχι στην ίδια ομάδα με το χρήστη που το δημιούργησε.

```Shell
chmod g+sw file
```
Το αρχείο `file` επιτρέπεται να τροποποιηθεί από τα μέλη της ομάδας στην οποία ανήκει.
Οποιοσδήποτε χρήστης εκτελέσει το αρχείο `file`, το αρχείο θα εκτελεστεί, σαν να το εκτελεί χρήστης που ανήκει στην ομάδα στην οποία ανήκει το αρχείο.


# `getfacl`
Διαβάζει τη λίστα εξουσιοδότησης (ACL) ενός φακέλου ή αρχείου.


# `setfacl`

```Shell
setfacl -m u:username:rwx directory
```
Τροποποιεί τη λίστα εξουσιοδότησης ενός φακέλου.

```Shell
setfacl -b directory
```
Διαγράφει τη λίστα εξουσιοδότησης ενός φακέλου.


# Ομαδική τροποποίηση εξουσιοδοτήσεων
Το ότι οι φάκελοι απαιτούν εξουσιοδότηση εκτέλεσης για να προσπελαστούν ενώ τα αρχεία όχι, δημιουργεί κάποια προβλήματα όταν θέλουμε να αλλάξουμε τις εξουσιοδοτήσεις μιας ιεραρχίας αρχείων.

Για να το πετύχουμε αυτό εφαρμόζουμε 2 βήματα με την εντολή `find`.
```Shell
find directory -type f -not -regex ".*\.exe" -exec chmod 664 {} \;
```
Όλα τα **αρχεία** (`-type f`) του φακέλου `directory` που **δεν** (`-not`) τελειώνουν σε `".exe"` αποκτούν δικαιώματα `664`.

```Shell
find directory -type d -exec chmod g+x {} \;
```
Όλα οι **φάκελοι** (`-type d`) του φακέλου `directory` αποκτούν δικαιώματα εκτέλεσης για τα μέλη της ομάδας στην οποία ο κάθε ένας φάκελος ανήκει.
