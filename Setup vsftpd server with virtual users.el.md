# Οδηγός: Εγκατάσταση ενός vsftpd εξυπηρετητή για εικονικούς χρήστες


## Προβλήματα

Το πρωτόκολλο FTP είναι ένα από τα πιο παλιά πρωτόκολλα στο διαδίκτυο.

Δύο σοβαρά μειονεκτήματά του είναι παρακάτω:

### Δεν είναι κρυπτογραφημένο

Αυτό σημαίνει ότι σε καμία περίπτωση δεν προτείνεται να χρησιμοποιείται το FTP για να μεταφέρονται διαβαθμισμένα αρχεία.

Αλλά ακόμα χειρότερα, ακόμα και η αυθεντικοποίηση του χρήστη, δεν είναι κρυπτογραφημένη με αποτέλεσμα, αν υπάρχει κωδικός, να θεωρείται ότι έχει διαρρεύσει.

### Λειτουργεί σε διαφορετικές πόρτες

Ενώ η προκαθορισμένη πόρτα για τη μεταφορά των FTP εντολών είναι η 21, εντούτοις ανοίγονται τουλάχιστον μια ακόμα πόρτα για μεταφορά δεδομένων. Άρα το FTP πρωτόκολλο απαιτεί πολλές πόρτες ανοικτές.

Αυτό δημιουργεί πρόβλημα με κάποιους δρομολογητές.

Επίσης αυξάνει την πολυπλοκότητα για τον πελάτη FTP που θα πρέπει να επιλέξει αν θα λειτουργεί σε ενεργή ή παθητική κατάσταση, όπως λέγεται.


## Πλεονεκτήματα

Για τους παραπάνω λόγους, όλοι οι μεγάλοι περιηγητές διαδικτύου έχουν διακόψει την υποστήριξη του πρωτοκόλλου. Αντί για το FTP χρησιμοποιείται πλέον το WEB.

Υπάρχει όμως ένα πλεονέκτημα του FTP σε σχέση με το WEB. Οι FTP πελάτες, μπορούν να διαχειριστούν την ιεραρχία αρχείων και φακέλων του FTP και να μεταφορτώσουν ή ανεβάσουν ολόκληρους φακέλους με τα αρχεία τους. Αυτό δεν είναι δυνατό με κάποιο κοινά αποδεκτό πρωτόκολλο στο WEB, το οποίο να υποστηρίζεται και από λογισμικό.

Έτσι, το FTP πρωτόκολλο υποστηρίζεται σχεδόν από όλους τους διαχειριστές αρχείων (συμπεριλαμβανομένης της Εξερεύνησης Αρχείων των Windows) αλλά και από FTP προγράμματα πελάτες.


## Τι θα κάνουμε - Εισαγωγή

Όπως αναφέρθηκε παραπάνω, δεν είναι καθόλου καλή επιλογή να μεταφέρουμε εμπιστευτικά αρχεία με το FTP. Επίσης δεν έχει κανένα νόημα να υπάρχει κωδικός στον εικονικό χρήστη.

Θα διαθέσουμε ιεραρχίες φακέλων και αρχείων στο διαδίκτυο, που προορίζονται για κοινή θέαση.

Για να διαθέσουμε ανεξάρτητες ιεραρχίες αρχείων (π.χ. Music, Videos, Books) κάτω από τον ίδιο εξυπηρετητή vsftpd, θα εισάγουμε πολλούς εικονικούς χρήστες στον εξυπηρετητή vsftpd, χωρίς κωδικό ή ακόμα και με κωδικό (έχοντας όμως υπόψη ότι ο κωδικός είναι πολύ εύκολο να διαρρεύσει).

Θα δημιουργήσουμε λοιπόν ένα χρήστη `engineer` που θα έχει πρόσβαση στην ιεραρχία αρχείων, κάτω από τον φάκελο-ρίζα `/media/nas/Μηχανικός/` και ένα χρήστη `upload`  που θα έχει πρόσβαση στην ιεραρχία αρχείων, κάτω από τον φάκελο-ρίζα `/media/nas/upload/`.


## Εγκατάσταση απαιτούμενων πακέτων

Εξασφαλίζουμε την εγκατάσταση των απαιτούμενων πακέτων. Η εγκατάσταση απευθύνεται σε Debian ή βασισμένα σε Debian Linux.
```Shell
apt install vsftpd libpam-pwdfile
```


## Δημιουργία χρήστη για τον vsftpd εξυπηρετητή

Δημιουργούμε το χρήστη με τον οποίο θα εκτελείται ο vsftpd εξυπηρετητής:
```Shell
useradd -N -s /bin/false -d /home/vsftpd vsftpd
```

## Επεξεργασία αρχείων ρυθμίσεων

Το αρχείο `/etc/pam.d/vsftpd` καθορίζει με ποιο τρόπο θα πραγματοποιείται η αυθεντικοποίηση των εικονικών χρηστών του vsftpd εξυπηρετητή:
```INI
auth required pam_pwdfile.so pwdfile /etc/vsftpd/ftpd.passwd
account required pam_permit.so
```

Το αρχείο `/etc/vsftpd.conf` καθορίζει τις κύριες ρυθμίσεις του vsftpd εξυπηρετητή:
```INI
listen=YES
#listen_ipv6=YES
anonymous_enable=NO
local_enable=YES
write_enable=YES
local_umask=022
xferlog_enable=YES
# Χρήστης vsftpd
nopriv_user=vsftpd
chroot_local_user=YES
# Αρχείο ρυθμίσεων /etc/pam.d/vsftpd
pam_service_name=vsftpd
utf8_filesystem=YES
hide_ids=YES
user_config_dir=/etc/vsftpd_user_conf
guest_enable=YES
virtual_use_local_privs=YES
guest_username=vsftpd
```

Στο αρχείο `/etc/vsftpd/ftpd.passwd` αποθηκεύονται οι εικονικοί χρήστες και οι κωδικοί τους.

Αν δεν υπάρχει κωδικός, τότε δεν απαιτείται κατά την αυθεντικοποίηση. Αν όμως θέλουμε ο χρήστης να έχει κωδικό τότε αυτός δημιουργείται ως εξής: (ας υποθέσουμε ότι ο χρήστης είναι `upload`). Με `-d` προστίθεται στο τέλος του υπάρχοντος αρχείου ενώ με `-cd` δημιουργείται το αρχείο και προστίθεται.
```Shell
htpasswd -d /etc/vsftpd/ftpd.passwd upload
```
Παρακάτω ακολουθεί το αρχείο `/etc/vsftpd/ftpd.passwd` με τον εικονικό χρήστη `engineer` χωρίς κωδικό και τον χρήστη `upload` με κωδικό `pavlos`:
```INI
engineer:
upload:X7nyBRuyuJVyg
```
Το αρχείο `/etc/vsftpd_user_conf/engineer` που καθορίζει τις ρυθμίσεις του εικονικού χρήστη `engineer` είναι:
```INI
local_root=/media/nas/Μηχανικός
hide_file={/personal files,/a folder/a file}
```
Ενώ το αρχείο `/etc/vsftpd_user_conf/upload` που καθορίζει τις ρυθμίσεις του εικονικού χρήστη `upload` είναι:
```INI
local_root=/media/nas/upload
download_enable=NO
write_enable=YES
allow_writeable_chroot=YES
```
